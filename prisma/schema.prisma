// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ==================== ORGANIZATION MODULE ====================

// Organization Profile
model Organization {
  id                 String   @id @default(cuid())
  name               String
  establishedDate    String?
  employeeCount      Int      @default(0)
  branchCount        Int      @default(0)
  headOfficeLocation String?
  headOfficeAddress  String?
  website            String?
  description        String?
  vision             String?
  mission            String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

// Departments
model Department {
  id           String        @id @default(cuid())
  name         String        @unique
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  users        User[]
  issues       Issue[]
  stakeholders Stakeholder[]
  controls     Control[]
  processes    Process[]
  policies     Policy[]
  assets       Asset[]
  risks        Risk[]
  audits       Audit[]
  evidences    Evidence[]
  exceptions   Exception[]
}

// Users
model User {
  id           String      @id @default(cuid())
  userName     String      @unique
  email        String      @unique
  password     String
  firstName    String
  lastName     String
  fullName     String
  designation  String?
  function     String?
  role         String      @default("User")
  language     String      @default("English")
  timezone     String      @default("UTC")
  isActive     Boolean     @default(true)
  isBlocked    Boolean     @default(false)
  departmentId String?
  department   Department? @relation(fields: [departmentId], references: [id])
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  // Relations
  ownedControls    Control[]    @relation("ControlOwner")
  assignedControls Control[]    @relation("ControlAssignee")
  ownedRisks       Risk[]       @relation("RiskOwner")
  ownedProcesses   Process[]    @relation("ProcessOwner")
  ownedAssets      Asset[]      @relation("AssetOwner")
  custodianAssets  Asset[]      @relation("AssetCustodian")
  assignedEvidences Evidence[]  @relation("EvidenceAssignee")
  auditor          Audit[]      @relation("Auditor")
}

// Stakeholders
model Stakeholder {
  id           String      @id @default(cuid())
  name         String
  email        String?
  type         String      @default("Internal") // Internal, External, Third Party
  status       String      @default("Active") // Active, Inactive
  departmentId String?
  department   Department? @relation(fields: [departmentId], references: [id])
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

// Issues
model Issue {
  id           String      @id @default(cuid())
  title        String
  description  String?
  domain       String // Internal, External, IT, GRC
  category     String // Finance, Human Resources, Data breach, etc.
  status       String      @default("Open") // Open, In Progress, Pending, Resolved, Closed
  dueDate      DateTime?
  departmentId String?
  department   Department? @relation(fields: [departmentId], references: [id])
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

// Services
model Service {
  id              String   @id @default(cuid())
  title           String
  description     String?
  serviceUser     String // Internal, External, Public
  serviceCategory String?
  serviceItem     String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

// ==================== COMPLIANCE MODULE ====================

// Frameworks
model Framework {
  id          String    @id @default(cuid())
  name        String    @unique
  description String?
  version     String?
  status      String    @default("Subscribed") // Subscribed, Not Subscribed
  logo        String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  controls    Control[]
  evidences   Evidence[]
}

// Regulations (legacy - keeping for backwards compatibility)
model Regulation {
  id        String   @id @default(cuid())
  name      String   @unique
  status    String   @default("Subscribed") // Subscribed, Not Subscribed
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Control Domains
model ControlDomain {
  id        String    @id @default(cuid())
  name      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  controls  Control[]
}

// Controls
model Control {
  id                String         @id @default(cuid())
  controlCode       String         @unique
  name              String
  description       String?
  controlQuestion   String?
  functionalGrouping String?       // Govern, Identify, Protect, Detect, Respond, Recover
  status            String         @default("Non Compliant") // Non Compliant, Compliant, Not Applicable
  domainId          String?
  domain            ControlDomain? @relation(fields: [domainId], references: [id])
  frameworkId       String?
  framework         Framework?     @relation(fields: [frameworkId], references: [id])
  departmentId      String?
  department        Department?    @relation(fields: [departmentId], references: [id])
  ownerId           String?
  owner             User?          @relation("ControlOwner", fields: [ownerId], references: [id])
  assigneeId        String?
  assignee          User?          @relation("ControlAssignee", fields: [assigneeId], references: [id])
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  evidences         Evidence[]
  exceptions        Exception[]
  riskControls      RiskControl[]
}

// Processes
model Process {
  id           String      @id @default(cuid())
  processCode  String      @unique
  name         String
  description  String?
  processType  String      @default("Primary") // Primary, Management, Supporting
  departmentId String?
  department   Department? @relation(fields: [departmentId], references: [id])
  ownerId      String?
  owner        User?       @relation("ProcessOwner", fields: [ownerId], references: [id])
  status       String      @default("Active")
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  risks        Risk[]      @relation("RiskProcess")
}

// Governance - Policies, Standards, Procedures
model Policy {
  id            String      @id @default(cuid())
  name          String
  version       String      @default("1.0")
  documentType  String      @default("Policy") // Policy, Standard, Procedure
  departmentId  String?
  department    Department? @relation(fields: [departmentId], references: [id])
  status        String      @default("Draft") // Not Uploaded, Draft, Approved, Needs Review, Published
  effectiveDate DateTime?
  reviewDate    DateTime?
  content       String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

// Evidence
model Evidence {
  id           String      @id @default(cuid())
  name         String
  description  String?
  frameworkId  String?
  framework    Framework?  @relation(fields: [frameworkId], references: [id])
  controlId    String?
  control      Control?    @relation(fields: [controlId], references: [id])
  departmentId String?
  department   Department? @relation(fields: [departmentId], references: [id])
  assigneeId   String?
  assignee     User?       @relation("EvidenceAssignee", fields: [assigneeId], references: [id])
  dueDate      DateTime?
  status       String      @default("Pending") // Pending, Submitted, Approved, Rejected, Overdue
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

// Exceptions
model Exception {
  id           String      @id @default(cuid())
  title        String
  description  String?
  exceptionType String     // Control, Compliance, Policy
  departmentId String?
  department   Department? @relation(fields: [departmentId], references: [id])
  controlId    String?
  control      Control?    @relation(fields: [controlId], references: [id])
  status       String      @default("Pending") // Pending, Approved, Authorized, Closed, Overdue
  startDate    DateTime?
  endDate      DateTime?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

// ==================== ASSET MANAGEMENT MODULE ====================

// Asset Category (Top-level categories: Hardware, Software, Data, etc.)
model AssetCategory {
  id            String             @id @default(cuid())
  name          String             @unique
  description   String?
  status        String             @default("Active") // Active, Inactive
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  subCategories AssetSubCategory[]
  assets        Asset[]
}

// Asset Sub Category (e.g., Server, Firewall under Hardware)
model AssetSubCategory {
  id                      String                   @id @default(cuid())
  name                    String
  description             String?
  categoryId              String
  category                AssetCategory            @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  status                  String                   @default("Active") // Active, Inactive
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime                 @updatedAt
  assets                  Asset[]
  assetCIAClassifications AssetCIAClassification[]

  @@unique([name, categoryId])
}

// Asset Group (Logical groupings: Security Tools, Payment Systems, etc.)
model AssetGroup {
  id                      String                   @id @default(cuid())
  name                    String                   @unique
  description             String?
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime                 @updatedAt
  assets                  Asset[]
  assetCIAClassifications AssetCIAClassification[]
  riskAssetGroups         RiskAssetGroup[]
}

// CIA Rating Levels (for Confidentiality, Integrity, Availability)
model CIARating {
  id        String   @id @default(cuid())
  type      String   // Confidentiality, Integrity, Availability
  label     String   // high, medium, low
  value     Int      // Score value (e.g., 10, 5, 1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([type, label])
}

// Asset Sensitivity Levels
model AssetSensitivity {
  id          String   @id @default(cuid())
  name        String   @unique // Public, Internal, Confidential, Restricted
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  assets      Asset[]
}

// Asset CIA Classification (Links Sub Category + Group with CIA ratings)
model AssetCIAClassification {
  id                    String           @id @default(cuid())
  subCategoryId         String
  subCategory           AssetSubCategory @relation(fields: [subCategoryId], references: [id], onDelete: Cascade)
  groupId               String
  group                 AssetGroup       @relation(fields: [groupId], references: [id], onDelete: Cascade)
  confidentiality       String           @default("low") // high, medium, low
  confidentialityScore  Int              @default(1)
  integrity             String           @default("low") // high, medium, low
  integrityScore        Int              @default(1)
  availability          String           @default("low") // high, medium, low
  availabilityScore     Int              @default(0)
  assetCriticality      String           @default("low") // high, medium, low
  assetCriticalityScore Int              @default(1)
  createdAt             DateTime         @default(now())
  updatedAt             DateTime         @updatedAt

  @@unique([subCategoryId, groupId])
}

// Asset Lifecycle Status
model AssetLifecycleStatus {
  id          String   @id @default(cuid())
  name        String   @unique // Active, In Use, Needs Maintenance, Retired
  description String?
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  assets      Asset[]
}

// Asset Classification (Legacy - keeping for backwards compatibility)
model AssetClassification {
  id          String   @id @default(cuid())
  name        String   @unique // Critical, High, Medium, Low
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  assets      Asset[]
}

// Assets
model Asset {
  id                String                @id @default(cuid())
  assetId           String                @unique
  name              String
  description       String?
  // Category hierarchy
  categoryId        String?
  category          AssetCategory?        @relation(fields: [categoryId], references: [id])
  subCategoryId     String?
  subCategory       AssetSubCategory?     @relation(fields: [subCategoryId], references: [id])
  groupId           String?
  group             AssetGroup?           @relation(fields: [groupId], references: [id])
  // Legacy asset type (keeping for backwards compatibility)
  assetType         String?               // Hardware, Software, Information, People, Services, Facility
  // Department and ownership
  departmentId      String?
  department        Department?           @relation(fields: [departmentId], references: [id])
  ownerId           String?
  owner             User?                 @relation("AssetOwner", fields: [ownerId], references: [id])
  custodianId       String?
  custodian         User?                 @relation("AssetCustodian", fields: [custodianId], references: [id])
  // Classification
  classificationId  String?
  classification    AssetClassification?  @relation(fields: [classificationId], references: [id])
  sensitivityId     String?
  sensitivity       AssetSensitivity?     @relation(fields: [sensitivityId], references: [id])
  // Lifecycle
  lifecycleStatusId String?
  lifecycleStatus   AssetLifecycleStatus? @relation(fields: [lifecycleStatusId], references: [id])
  status            String                @default("Active") // Legacy status field
  // Asset details
  value             Float?
  location          String?
  acquisitionDate   DateTime?
  nextReviewDate    DateTime?
  // Timestamps
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt
}

// ==================== RISK MANAGEMENT MODULE ====================

// Risk Categories (Top level categories)
model RiskCategory {
  id            String           @id @default(cuid())
  name          String           @unique
  description   String?
  status        String           @default("Active") // Active, Inactive
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  risks         Risk[]
  subCategories RiskSubCategory[]
}

// Risk Sub Categories
model RiskSubCategory {
  id          String        @id @default(cuid())
  name        String
  description String?
  categoryId  String
  category    RiskCategory  @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  status      String        @default("Active")
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@unique([name, categoryId])
}

// Threat Categories
model ThreatCategory {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  threats     Threat[]
}

// Threats
model Threat {
  id            String          @id @default(cuid())
  name          String          @unique
  description   String?
  categoryId    String?
  category      ThreatCategory? @relation(fields: [categoryId], references: [id])
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  riskThreats   RiskThreat[]
}

// Vulnerability Categories
model VulnerabilityCategory {
  id              String          @id @default(cuid())
  name            String          @unique
  description     String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  vulnerabilities Vulnerability[]
}

// Vulnerabilities
model Vulnerability {
  id                  String                 @id @default(cuid())
  name                String                 @unique
  description         String?
  categoryId          String?
  category            VulnerabilityCategory? @relation(fields: [categoryId], references: [id])
  createdAt           DateTime               @default(now())
  updatedAt           DateTime               @updatedAt
  riskVulnerabilities RiskVulnerability[]
}

// Vulnerability Ratings
model VulnerabilityRating {
  id          String   @id @default(cuid())
  name        String   @unique // strong, medium, Weak
  score       Int      // 10, 7, 5
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// Likelihood Settings
model Likelihood {
  id          String   @id @default(cuid())
  title       String   @unique // Rare, Moderate, High
  score       Int      // 1, 5, 10
  timeFrame   String?
  probability String?  // Minimum, Medium, High
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// Impact Categories (financial, Reputational, Regulatory, Safety, Operational)
model ImpactCategory {
  id           String         @id @default(cuid())
  name         String         @unique
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  impactRatings ImpactRating[]
}

// Impact Ratings
model ImpactRating {
  id          String          @id @default(cuid())
  name        String          @unique // High impact, Low, Insignificant, Minor
  score       Int             // 20, 10, 5, 2
  description String?
  categoryId  String?
  category    ImpactCategory? @relation(fields: [categoryId], references: [id])
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
}

// Control Strength (for Risk Management)
model ControlStrength {
  id          String   @id @default(cuid())
  name        String   @unique // effective, ineffective, partially effective, optimized
  score       Int      // 100, 1, 20, 30
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// Risk Methodology Configuration
model RiskMethodology {
  id                   String   @id @default(cuid())
  includeLikelihood    Boolean  @default(true)
  includeImpact        Boolean  @default(true)
  includeAssetScore    Boolean  @default(false)
  includeVulnerability Boolean  @default(true)
  riskTolerance        Int      @default(10)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

// Risk Ranges (for rating calculation)
model RiskRange {
  id          String   @id @default(cuid())
  title       String   @unique // Low Risk, High, very high, Catastrophic
  color       String   // hex color code
  lowRange    Int      // minimum score
  highRange   Int      // maximum score
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// Risks
model Risk {
  id                    String              @id @default(cuid())
  riskId                String              @unique // Auto-generated RIDxxxx
  name                  String
  description           String?
  riskType              String              @default("Asset Risk") // Asset Risk, Process Risk
  riskSources           String?
  cause                 String?
  // Category
  categoryId            String?
  category              RiskCategory?       @relation(fields: [categoryId], references: [id])
  // Department & Owner
  departmentId          String?
  department            Department?         @relation(fields: [departmentId], references: [id])
  ownerId               String?
  owner                 User?               @relation("RiskOwner", fields: [ownerId], references: [id])
  // Related Process (when riskType = "Process Risk")
  relatedProcessId      String?
  relatedProcess        Process?            @relation("RiskProcess", fields: [relatedProcessId], references: [id])
  // Assessment scores
  likelihoodScore       Float?
  impactScore           Float?
  vulnerabilityScore    Float?
  inherentRiskRating    Float?              // Calculated: likelihood * impact * vulnerability
  controlRating         Float?              // Control effectiveness
  residualRiskRating    Float?              // After controls applied
  // Risk rating (calculated from risk ranges)
  riskRating            String              @default("Low Risk") // Low Risk, High, very high, Catastrophic
  // Response Strategy
  responseStrategy      String?             // Accept, Avoid, Transfer, Treat
  // Status & workflow
  status                String              @default("Open") // Open, In-Progress, Completed, Awaiting Approval, Closed
  assessmentStatus      String              @default("Assessment Pending") // Assessment Pending, Assessed
  assessmentDate        DateTime?
  nextReviewDate        DateTime?
  dueDate               DateTime?
  // Budget for Risk Response
  budgetAllocated       Float?
  budgetUsed            Float?
  // Timestamps
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  // Relations
  riskCategories        RiskCategoryMapping[]
  riskThreats           RiskThreat[]
  riskVulnerabilities   RiskVulnerability[]
  riskAssetGroups       RiskAssetGroup[]
  riskControls          RiskControl[]
  riskAssessments       RiskAssessment[]
}

// Risk to Category mapping (many-to-many for multi-select)
model RiskCategoryMapping {
  id         String        @id @default(cuid())
  riskId     String
  risk       Risk          @relation(fields: [riskId], references: [id], onDelete: Cascade)
  categoryId String
  createdAt  DateTime      @default(now())

  @@unique([riskId, categoryId])
}

// Risk to Threat mapping (many-to-many)
model RiskThreat {
  id               String   @id @default(cuid())
  riskId           String
  risk             Risk     @relation(fields: [riskId], references: [id], onDelete: Cascade)
  threatId         String
  threat           Threat   @relation(fields: [threatId], references: [id], onDelete: Cascade)
  likelihoodScore  Int?     // Rare=1, Moderate=5, High=10
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  threatImpacts    ThreatImpact[]

  @@unique([riskId, threatId])
}

// Threat Impact ratings per category
model ThreatImpact {
  id              String     @id @default(cuid())
  riskThreatId    String
  riskThreat      RiskThreat @relation(fields: [riskThreatId], references: [id], onDelete: Cascade)
  impactCategory  String     // financial, Reputational impact, Regulatory, Safety, Operational
  impactRating    String?    // Low, Insignificant, Minor, High impact
  impactScore     Int?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  @@unique([riskThreatId, impactCategory])
}

// Risk to Vulnerability mapping (many-to-many)
model RiskVulnerability {
  id              String        @id @default(cuid())
  riskId          String
  risk            Risk          @relation(fields: [riskId], references: [id], onDelete: Cascade)
  vulnerabilityId String
  vulnerability   Vulnerability @relation(fields: [vulnerabilityId], references: [id], onDelete: Cascade)
  rating          String?       // strong, medium, Weak
  score           Int?          // 10, 7, 5
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@unique([riskId, vulnerabilityId])
}

// Risk to Asset Group mapping (many-to-many, for Asset Risk type)
model RiskAssetGroup {
  id           String      @id @default(cuid())
  riskId       String
  risk         Risk        @relation(fields: [riskId], references: [id], onDelete: Cascade)
  assetGroupId String
  assetGroup   AssetGroup  @relation(fields: [assetGroupId], references: [id], onDelete: Cascade)
  createdAt    DateTime    @default(now())

  @@unique([riskId, assetGroupId])
}

// Risk to Control mapping (existing + planned controls)
model RiskControl {
  id          String   @id @default(cuid())
  riskId      String
  risk        Risk     @relation(fields: [riskId], references: [id], onDelete: Cascade)
  controlId   String
  control     Control  @relation(fields: [controlId], references: [id], onDelete: Cascade)
  isPlanned   Boolean  @default(false) // true = planned control, false = existing control
  effectiveness Float? // Control effectiveness percentage
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([riskId, controlId])
}

// Risk Assessments (tracking assessment history)
model RiskAssessment {
  id                   String   @id @default(cuid())
  riskId               String
  risk                 Risk     @relation(fields: [riskId], references: [id], onDelete: Cascade)
  assessmentNumber     Int      @default(1)
  // Assessment step tracking
  currentStep          Int      @default(1) // 1-6: Risk Context, Likelihood, Impact, Vulnerability, Risk Rating, Risk Summary
  isCompleted          Boolean  @default(false)
  // Calculated scores
  likelihoodScore      Float?
  impactScore          Float?
  vulnerabilityScore   Float?
  inherentRiskRating   Float?
  controlRating        Float?
  residualRiskRating   Float?
  riskRating           String?  // Low Risk, High, very high, Catastrophic
  // Status
  status               String   @default("In-Progress") // In-Progress, Completed, Awaiting Approval, Approved
  assessmentDate       DateTime @default(now())
  approvedBy           String?
  approvedDate         DateTime?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

// ==================== INTERNAL AUDIT MODULE ====================

// Audits
model Audit {
  id           String         @id @default(cuid())
  auditId      String         @unique
  name         String
  description  String?
  auditType    String?        // Internal, External
  departmentId String?
  department   Department?    @relation(fields: [departmentId], references: [id])
  auditorId    String?
  auditor      User?          @relation("Auditor", fields: [auditorId], references: [id])
  status       String         @default("Planned") // Planned, In Progress, Completed, Cancelled
  startDate    DateTime?
  endDate      DateTime?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  findings     AuditFinding[]
}

// Audit Findings
model AuditFinding {
  id          String   @id @default(cuid())
  findingId   String   @unique
  title       String
  description String?
  auditId     String?
  audit       Audit?   @relation(fields: [auditId], references: [id])
  severity    String   @default("Medium") // High, Medium, Low
  status      String   @default("Open") // Open, In Progress, Closed
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  capas       CAPA[]
}

// CAPA (Corrective and Preventive Actions)
model CAPA {
  id          String        @id @default(cuid())
  capaId      String        @unique
  title       String
  description String?
  findingId   String?
  finding     AuditFinding? @relation(fields: [findingId], references: [id])
  actionType  String        @default("Corrective") // Corrective, Preventive
  status      String        @default("Open") // Open, In Progress, Closed, Overdue
  dueDate     DateTime?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

// ==================== AUDIT LOGS ====================

model AuditLog {
  id          String   @id @default(cuid())
  changeType  String // CREATE, UPDATE, DELETE
  entityType  String // e.g., Control, User, Risk
  entityId    String
  userId      String?
  userName    String?
  changes     String? // JSON string of old/new values
  createdAt   DateTime @default(now())
}
